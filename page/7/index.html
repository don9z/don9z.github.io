<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=PT+Serif:300,300italic,400,400italic,700,700italic|Old+Standard+TT:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.zhengdong.me","root":"/","scheme":"Gemini","version":"8.0.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":{"disqus":null}},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Extra Cookies">
<meta property="og:url" content="http://blog.zhengdong.me/page/7/index.html">
<meta property="og:site_name" content="Extra Cookies">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Dong Zheng">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://blog.zhengdong.me/page/7/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Extra Cookies</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-17531526-2"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-17531526-2');
      }
    </script>






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Extra Cookies</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">By Dong ZHENG</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <section class="post-toc-wrap sidebar-panel">
        </section>
        <!--/noindex-->

        <section class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Dong Zheng</p>
  <div class="site-description" itemprop="description"></div>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="http://zhengdong.me/" title="About → http:&#x2F;&#x2F;zhengdong.me" rel="noopener" target="_blank"><i class="fa fa-user fa-fw"></i>About</a>
      </span>
      <span class="links-of-author-item">
        <a href="http://feeds.feedburner.com/ExtraCookies" title="RSS → http:&#x2F;&#x2F;feeds.feedburner.com&#x2F;ExtraCookies" rel="noopener" target="_blank"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </span>
  </div>



        </section>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">
      

      
    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.zhengdong.me/2013/07/12/using-ios-android-libraries-cocos2dx/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dong Zheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Extra Cookies">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2013/07/12/using-ios-android-libraries-cocos2dx/" class="post-title-link" itemprop="url">Using iOS and Android Libraries in Cocos2D-X</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2013-07-12 18:21:00" itemprop="dateCreated datePublished" datetime="2013-07-12T18:21:00+08:00">2013-07-12</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Been working on some libs on both iOS and Android platforms for a long time, recently needed to support <a target="_blank" rel="noopener" href="http://www.cocos2d-x.org">Cocos2d-x</a> framework, I have no interest to write a whole new lib based on C++, nightmare for maintenance, So I worked on to integrate both libs to Cocos2d-x framework.</p>
<h2 id="ios">iOS</h2>
<p>Imagine my lib name is <code>libHumbleAssistant.a</code>, with a header file <code>HumbleAssistant.h</code>.</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">HumbleAssistant</span> : <span class="title">NSObject</span></span></span><br><span class="line">+ (<span class="keyword">void</span>)doSomething:(<span class="built_in">NSString</span> *)order;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>Lucky me, Objective C belongs to C family, which could integrate with C and C++ seamlessly.</p>
<p>At first, create a <code>.h</code> header file as the real interface for C++ code, and name it as <code>humble_assistant_cpp.h</code>.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HumbleAssistantCpp</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">do_something</span><span class="params">(<span class="keyword">char</span> *order)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Then, create its source <code>humble_assistant_cpp.mm</code>, <code>.mm</code> stands for <a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Objective-C#Objective-C.2B.2B">Objective-C++</a>, in which, people can hybrid programming with Objective C and C++.</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&quot;HumbleAssistant.h&quot;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&quot;humble_assistant_cpp.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> HumbleAssistantCpp::do_something(<span class="keyword">char</span> *order) &#123;</span><br><span class="line">    [HumbleAssistant doSomething:[<span class="built_in">NSString</span> stringWithUTF8String:order]];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Now, the file structures looks like this</p>
<pre><code>-mylibs
  -ios
    - HumbleAssistant.h
    - libHumbleAssistant.a
    - humble_assistant_cpp.h
    - humble_assistant_cpp.mm</code></pre>
<p>In a Cocos2d-x project, add those files, and include the <code>humble_assistant_cpp.h</code> to any C++ code that is about to ask the humble assistant a favor. It's that simple.</p>
<h2 id="android">Android</h2>
<p><a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Java_Native_Interface">JNI</a> is used to bind Cocos2d-x and Android Java interfaces.</p>
<p>In order to call a method in a <a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/JAR_(file_format)">jar</a> lib from C++, JNI code must be written.</p>
<p>Imagine my android lib is <code>humbleAssistant.jar</code>, and has an interface as below.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.my.libs;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">HumbleAssistant</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">(String order)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>To expose this method to C++, first, create a header file <code>humble_assistant_jni.h</code>.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">j_do_something</span><span class="params">(<span class="keyword">char</span> *order)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Then, its implementation <code>humble_assistant_jni.cpp</code>, a little complicated due to the JNI's obscure grammar.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;platform/android/jni/JniHelper.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;humble_assistant_jni.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// java Class location</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span>  CLASS_NAME <span class="meta-string">&quot;com/my/libs/HumbleAssistant&quot;</span></span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">j_do_something</span><span class="params">(<span class="keyword">char</span> *order)</span> </span>&#123;</span><br><span class="line">        cocos2d::JniMethodInfo methodInfo;</span><br><span class="line">        <span class="keyword">if</span> (cocos2d::JniHelper::getStaticMethodInfo(methodInfo, CLASS_NAME,</span><br><span class="line">                                      <span class="string">&quot;doSomething&quot;</span>, <span class="string">&quot;(Ljava/lang/String;)V&quot;</span>)) &#123;</span><br><span class="line">            jstring j_order = methodInfo.env-&gt;NewStringUTF(order);</span><br><span class="line">            methodInfo.env-&gt;CallStaticVoidMethod(methodInfo.classID,</span><br><span class="line">                                                 methodInfo.methodID,</span><br><span class="line">                                                 j_order);</span><br><span class="line">            methodInfo.env-&gt;DeleteLocalRef(j_order);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Cocos2d-x is a cross platform framework, our libs need to be that too, only one single interface is needed.</p>
<p>In iOS, a <code>humble_assistant_cpp.h</code> is created, which is the universal header file for both platforms. And <code>humble_assistant_cpp.mm</code> is the source file.</p>
<p>So, in Android, we have to make a new source file <code>humble_assistant_cpp.cpp</code>.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;humble_assistant_cpp.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;humble_assistant_jni.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">HumbleAssistant::do_something</span><span class="params">(<span class="keyword">char</span> *order)</span> </span>&#123;</span><br><span class="line">    j_do_something(order);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Now, the file structures looks like this</p>
<pre><code>-mylibs
  -ios
    - HumbleAssistant.h
    - libHumbleAssistant.a
    - humble_assistant_cpp.h
    - humble_assistant_cpp.mm
  -android
    - humble_assistant_jni.h
    - humble_assistant_jni.cpp
    - humble_assistant_cpp.cpp</code></pre>
<p>But it's not finished.</p>
<p>We have to change the makefile in "proj.android/jni/android.mk" to add source files and the header file.</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Add source files</span></span><br><span class="line">LOCAL_SRC_FILES := ... \</span><br><span class="line">                   ../../sdk/android/humble_assistant_jni.cpp \</span><br><span class="line">                   ../../sdk/android/humble_assistant_cpp.cpp</span><br><span class="line"></span><br><span class="line"><span class="comment"># Include header file</span></span><br><span class="line">LOCAL_C_INCLUDES := ... <span class="variable">$(LOCAL_PATH)</span>/../../mylibs/ios</span><br></pre></td></tr></table></figure>
<p>And also, put the jar lib into "proj.android/libs" folder.</p>
<p>It's done. Looks much more complicated than iOS way, and could be even worse.</p>
<p>If the <code>doSomething</code> interface needs a <code>HashMap</code> parameter, JNI code will be full of stupid code.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">j_do_something</span><span class="params">(<span class="keyword">char</span> *order, <span class="built_in">std</span>::<span class="built_in">map</span>&lt;<span class="keyword">char</span>*, <span class="keyword">char</span>*&gt; attributes)</span> </span>&#123;</span><br><span class="line">    cocos2d::JniMethodInfo methodInfo;</span><br><span class="line">    <span class="keyword">if</span> (cocos2d::JniHelper::getStaticMethodInfo(methodInfo, CLASS_NAME,</span><br><span class="line">                                                <span class="string">&quot;doSomething&quot;</span>, <span class="string">&quot;(Ljava/lang/String;Ljava/util/Map;)V&quot;</span>)) &#123;</span><br><span class="line">        jobject jattributes = <span class="number">0</span>;</span><br><span class="line">        jclass hashMapClass = methodInfo.env-&gt;FindClass(<span class="string">&quot;java/util/HashMap&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (hashMapClass) &#123;</span><br><span class="line">            jsize mapSize = attributes.size();</span><br><span class="line">            jmethodID init = methodInfo.env-&gt;GetMethodID(hashMapClass, <span class="string">&quot;&lt;init&gt;&quot;</span>, <span class="string">&quot;(I)V&quot;</span>);</span><br><span class="line">            jobject hashMap = methodInfo.env-&gt;NewObject(hashMapClass, init, mapSize);</span><br><span class="line">            jmethodID putMethod = methodInfo.env-&gt;GetMethodID(hashMapClass, <span class="string">&quot;put&quot;</span>,</span><br><span class="line">                                                              <span class="string">&quot;(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">std</span>::<span class="built_in">map</span>&lt;<span class="keyword">char</span>*, <span class="keyword">char</span>*&gt;::const_iterator it = attributes.begin();</span><br><span class="line">                 it != attributes.end(); ++it) &#123;</span><br><span class="line">                jstring key = methodInfo.env-&gt;NewStringUTF(it-&gt;first);</span><br><span class="line">                jstring value = methodInfo.env-&gt;NewStringUTF(it-&gt;second);</span><br><span class="line">                methodInfo.env-&gt;CallObjectMethod(hashMap, putMethod, key, value);</span><br><span class="line">                methodInfo.env-&gt;DeleteLocalRef(value);</span><br><span class="line">                methodInfo.env-&gt;DeleteLocalRef(key);</span><br><span class="line">            &#125;</span><br><span class="line">            jattributes = hashMap;</span><br><span class="line">            methodInfo.env-&gt;DeleteLocalRef(hashMapClass);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        jstring jorder = methodInfo.env-&gt;NewStringUTF(order);</span><br><span class="line">        methodInfo.env-&gt;CallStaticVoidMethod(methodInfo.classID, methodInfo.methodID,</span><br><span class="line">                                             jorder, jattributes);</span><br><span class="line">        <span class="keyword">if</span> (jattributes)</span><br><span class="line">            methodInfo.env-&gt;DeleteLocalRef(jattributes);</span><br><span class="line">        methodInfo.env-&gt;DeleteLocalRef(jorder);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Feel lucky again that my lib only exposes static methods, with simple parameters.</p>
<p>Maybe that's why I don't like cross platform frameworks, and Android.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.zhengdong.me/2013/06/15/xitang/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dong Zheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Extra Cookies">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2013/06/15/xitang/" class="post-title-link" itemprop="url">Xitang</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2013-06-15 21:39:00" itemprop="dateCreated datePublished" datetime="2013-06-15T21:39:00+08:00">2013-06-15</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a><img src="/images/2013/xitang1.jpg" width="280"></a> <a><img src="/images/2013/xitang2.jpg" width="280"></a> <a><img src="/images/2013/xitang3.jpg" width="226"></a> <a><img src="/images/2013/xitang4.jpg" width="334"></a> <a><img src="/images/2013/xitang5.jpg" width="560"></a> <a><img src="/images/2013/xitang6.jpg" width="280"></a> <a><img src="/images/2013/xitang7.jpg" width="280"></a></p>
<p>-- Taken on June 13 ~ 14, 2013 (<a target="_blank" rel="noopener" href="https://www.flickr.com/photos/don9z/albums/72157634136179541">flickr</a>)</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.zhengdong.me/2013/05/20/http-cookie-browser-identity-privacy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dong Zheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Extra Cookies">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2013/05/20/http-cookie-browser-identity-privacy/" class="post-title-link" itemprop="url">HTTP Cookie, Browser Identity, and Privacy</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2013-05-20 18:30:00" itemprop="dateCreated datePublished" datetime="2013-05-20T18:30:00+08:00">2013-05-20</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="cookie">Cookie</h2>
<blockquote>
<p>A cookie, also known as an HTTP cookie, web cookie, or browser cookie, is a small piece of data sent from a website and stored in a user's web browser while a user is browsing a website. When the user browses the same website in the future, the data stored in the cookie can be retrieved by the website to notify the website of the user's previous activity. (<a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/HTTP_cookie">refer</a>)</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol">HTTP</a> is a stateless protocol, which does not require the HTTP server to retain information or status about each visit for the duration of multiple requests, when a HTTP server receives multiple requests, it can't recognize whether those requests are coming from one single browser or not.</p>
<p>HTTP cookie is designed to be a reliable mechanism for websites to remember the state of the website or activity the user had taken in the past. When a user visits a website, cookies are sent by user's browser to the HTTP server inside HTTP header fields, the HTTP server can set cookies for its own purposes and sent them back to the user, e.g., set values to identify the user.</p>
<p>With cookie, the website recognizes its users, on the one hand, users don't need to set language preferences or login, etc. every time when they visit the site again, on the other hand, the website could provide their users customized contents or services.</p>
<p>But business is business, although some sites provide free services, they need revenue, so, they insert ads to web pages, with cookie, they can customize the ads to suit the users' needs, those ads could be less bothered and probably has better <a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Click-through_rate">CTR</a> when their users see the ads.</p>
<p>Since cookies are isolated by domains, different sites can't share cookies, it's more like a compromise between convenience and privacy, as my point of view, it's a win-win situation.</p>
<p>Some advertising companies build systems, which can "share" cookies across multiple domains. When a user visits a website, it sets a user track cookie not only on its domain, but also on the domain of an advertising company, when the user visits another site which also use the system of that advertising company, the company recognizes him and displays ads according to the user's previous activities.</p>
<p>Imaging, if the two sites are Google and Amazon, then one day you searched some porn stuff on Google, and some days later, you visit Amazon, it shows porn video recommendations on the top page directly.</p>
<p>This is called <a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/HTTP_cookie#Privacy_and_third-party_cookies">Third-party cookies</a>, which goes too far, no longer a win-win situation.</p>
<p>Luckily, nearly all modern web browsers allow to disable third-party cookies, current version of <a target="_blank" rel="noopener" href="http://www.apple.com/safari/">Safari</a> even disable it by default.</p>
<p>I strongly recommend to disable it.</p>
<p>There might be some people are madly concern about their privacy, disable all cookies to forbid any website to track them, but doing this might make them more easier to be tracked by other ways.</p>
<h2 id="entropy">Entropy</h2>
<blockquote>
<p>Entropy is a measure of unpredictability or information content. (<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Entropy_(information_theory)">refer</a>)</p>
</blockquote>
<p>For a random <span class="math display">\[X\]</span> with <span class="math display">\[n\]</span> outcomes <span class="math display">\[\{x_1, ... x_n\}\]</span>, the entropy denoted by <span class="math display">\[H(X)\]</span>, is defined as</p>
<p><span class="math display">\[
    H(X) = -\sum_{i=1}^{n} p(x_i) log_b p(x_i)
\]</span></p>
<p><span class="math display">\[b\]</span> is the base of logarithm used, normally, it's <span class="math display">\[2\]</span>.</p>
<p>If there is a set of <span class="math display">\[n\]</span> possible events <span class="math display">\[\{x_1, ... x_n\}\]</span> with equal probability <span class="math display">\[p(x_i)=1/n\]</span>, the entropy of it would be</p>
<p><span class="math display">\[
    H(X) = -\sum_{i=1}^{n} p(x_i) log_b p(x_i)=-n\frac{1}{n} log_2 \frac{1}{n}=log_2 n
\]</span></p>
<p>Easily, we can conclude that the entropy is the number of bits needed to specify all the events.</p>
<p>If there is another set of <span class="math display">\[m\]</span> possible events <span class="math display">\[\{y_1, ... y_m\}\]</span> with equal probability <span class="math display">\[p(y_i)=1/m\]</span>, the two sets are independent, then the entropy would be</p>
<p><span class="math display">\[
    H(X)=-\sum_{i,j} p(x_i,y_j) log_b p(x_i,y_j)=-nm \frac{1}{nm} log_2 \frac{1}{nm}=log_2 n+log_2 m
\]</span></p>
<p>Thus, we can conclude that if we add sources of uncertainty, the overall uncertainty should be the sum of the individual uncertainties.</p>
<p>We could design a browser fingerprinting algorithm <span class="math display">\[f(x)\]</span> which gives an ID to every browser that visits, follows <a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Probability_distribution#Discrete_probability_distribution">discrete probability distribution</a></p>
<p><span class="math display">\[
    P(f_i)=\sum_i P(f(x)=i)=1
\]</span></p>
<p>The entropy is</p>
<p><span class="math display">\[
    H(F)=-\sum_{x=0}^{N} p(f_x) log_2(p(f_x))
\]</span></p>
<p>Given <span class="math display">\[X\]</span> different browsers, each has equal probability of visiting the website, its entropy is <span class="math display">\[log_2 X\]</span>.</p>
<blockquote>
<p>The uniform distribution on the interval [a,b] is the maximum entropy distribution among all continuous distributions which are supported in the interval [a, b] (which means that the probability density is 0 outside of the interval. (<a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Maximum_entropy_probability_distribution">refer</a>)</p>
</blockquote>
<p>Then if the entropy of the browser fingerprinting algorithm is at least <span class="math display">\[log_2 X\]</span>, the browsers are uniquely recognizable.</p>
<h2 id="browser-fingerprinting-algorithm">Browser Fingerprinting Algorithm</h2>
<p>According to this <a target="_blank" rel="noopener" href="http://www.mendeley.com/catalog/unique-web-browser-2/">paper</a>,</p>
<blockquote>
<p>In particular, a fingerprint that carries no more than 15-20 bits of identifying information will in almost all cases be sufficient to uniquely identify a particular browser, given its IP address, its subnet, or even just its Autonomous System Number.</p>
</blockquote>
<p>Below are the metrics it used to do browser fingerprinting:</p>
<ul>
<li>User Agent</li>
<li>HTTP ACCEPT headers</li>
<li>Cookies enabled?</li>
<li>Screen resolution</li>
<li>Timezone</li>
<li>Browser plugins, plugin versions, and MIME types</li>
<li>System fonts</li>
</ul>
<p>Those metrics could be easily obtained by simple scripts running on the user's browser. And here comes the pretty good results,</p>
<blockquote>
<p>In general, modern desktop browsers fare very poorly, and around 90% of these are unique. The least unique desktop browsers often have JavaScript disabled (perhaps via NoScript). iPhone and Android browsers are significantly more uniform and harder to fingerprint than desktop browsers.</p>
</blockquote>
<p>How to defend the fingerprinting algorithms?</p>
<p>There are two ways. First, hide the browser information, e.g., disable JavaScript. Second, make the browser similar to other browsers so that fingerprinting algorithm might misrecognize it.</p>
<p>But, hide information of the browser will make it less common, make it common will disclose its information. It's a paradox.</p>
<h2 id="the-mobile-internet-era">The Mobile Internet Era</h2>
<p>Smart phones, Apps are all around us, when privacy could be violated, the consequences might be worse than the internet browsers.</p>
<p>How do Apps track the device identity?</p>
<p>In iOS, UDID could be used to identify devices, luckily, it was banned by Apple, but after iOS 6, Apple provides the <a target="_blank" rel="noopener" href="https://developer.apple.com/news/?id=3212013a">Advertising identifiers</a> similar to UDID, except it can be switched off by user. Also, MAC address can be used too.</p>
<p>In Android, <a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/International_Mobile_Station_Equipment_Identity">IMEI</a>, Android device ID, and MAC address all can be used to identify the devices.</p>
<p>Those identifiers are different from cookies, since all cookies can be deleted, disabled, but MAC addresses, IMEIs, etc. can't be changed, and there is no way to prohibit Apps for getting those information.</p>
<p>Apps can share your device ID between each other, here's how do some mobile App marketing systems work:</p>
<p>An App displays some ads of other Apps from a marketing system, when a user taps on one ad to install the App, it would send a request to the marketing system with your device ID, when the user opens the newly installed App, that App would send another request to the marketing system with the same device ID, then the marketing system knows the click and activation rates of an ad.</p>
<p>And, there are some mobile analytics systems require their SDK to be embedded into target Apps, e.g., <a target="_blank" rel="noopener" href="http://www.google.com/analytics/features/mobile-app-analytics.html">Google Analytics</a>. If all Apps are using the SDK, and the system has the ability and motivation to analyze all the data it has collected, activities of every user across all Apps could be monitored.</p>
<p>How to defend those privacy threats?</p>
<p>We just can't.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>





  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/24/">24</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



      

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 2010 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder"><a target="_blank" rel="noopener" href="http://zhengdong.me">Dong Zheng</a></span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  


















  








  

  
      <script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              const target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    const script = document.createElement('script');
    script.src = '//cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-mml-chtml.js';
    script.defer = true;
    document.head.appendChild(script);
  } else {
    MathJax.startup.document.state(0);
    MathJax.typesetClear();
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


</body>
</html>
